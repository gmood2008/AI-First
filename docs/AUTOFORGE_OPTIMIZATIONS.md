# AutoForge ä¼˜åŒ–åŠŸèƒ½æ–‡æ¡£

æœ¬æ–‡æ¡£æè¿°äº† AutoForge çš„ä¼˜åŒ–åŠŸèƒ½å’Œæ”¹è¿›ã€‚

## ğŸš€ æ–°å¢åŠŸèƒ½

### 1. å¢å¼ºä¸Šä¸‹æ–‡æ„ŸçŸ¥ (Context Injection)

**åŠŸèƒ½ï¼š** æ”¯æŒé€šè¿‡å‚è€ƒæ–‡æ¡£å’Œä»£ç æä¾›ä¸Šä¸‹æ–‡

**ä½¿ç”¨æ–¹å¼ï¼š**
```bash
# å•ä¸ªå‚è€ƒæ–‡ä»¶
forge create "è°ƒç”¨å…¬å¸å†…éƒ¨ OA æ¥å£" --reference ./docs/oa_api.md

# å¤šä¸ªå‚è€ƒæ–‡ä»¶
forge create "é›†æˆå¤šä¸ª API" \
  --reference ./docs/api1.md \
  --reference ./docs/api2.md \
  --reference ./examples/sample_code.py
```

**æ”¯æŒçš„æ–‡ä»¶ç±»å‹ï¼š**
- `.md`, `.markdown` - Markdown æ–‡æ¡£
- `.py` - Python ä»£ç 
- `.txt` - çº¯æ–‡æœ¬
- `.json`, `.yaml`, `.yml` - é…ç½®æ–‡ä»¶
- `.rst` - reStructuredText

**åº”ç”¨åœºæ™¯ï¼š**
- å…¬å¸å†…éƒ¨ API æ–‡æ¡£
- ç°æœ‰ä»£ç é£æ ¼å‚è€ƒ
- SDK æ–‡æ¡£
- é…ç½®æ–‡ä»¶ç¤ºä¾‹

---

### 2. èƒ½åŠ›è¿›åŒ–æ¨¡å¼ (Update/Refine)

**åŠŸèƒ½ï¼š** æ›´æ–°ç°æœ‰èƒ½åŠ›è€Œä¸æ˜¯é‡æ–°åˆ›å»º

**ä½¿ç”¨æ–¹å¼ï¼š**
```bash
# æ›´æ–°ç°æœ‰èƒ½åŠ›
forge update net.crypto.get_price "è·å–æ¯”ç‰¹å¸ä»·æ ¼ï¼Œæ”¯æŒå¤šä¸ªäº¤æ˜“æ‰€"

# æˆ–ä½¿ç”¨ refine åˆ«å
forge refine net.crypto.get_price "æ·»åŠ é”™è¯¯é‡è¯•æœºåˆ¶"
```

**ç‰¹æ€§ï¼š**
- ä¿ç•™ç°æœ‰æ–‡ä»¶ç»“æ„
- æ”¯æŒé¢„è§ˆå˜æ›´ï¼ˆ`--preview`ï¼‰
- ç¡®è®¤è¦†ç›–ï¼ˆé™¤éä½¿ç”¨ `--force`ï¼‰
- æ”¯æŒå‚è€ƒæ–‡æ¡£ï¼ˆ`--reference`ï¼‰

**å·¥ä½œæµï¼š**
```bash
# 1. é¢„è§ˆå˜æ›´
forge update net.crypto.get_price "æ–°éœ€æ±‚" --preview

# 2. ç¡®è®¤åæ›´æ–°
forge update net.crypto.get_price "æ–°éœ€æ±‚"
```

---

### 3. æµ‹è¯•é©±åŠ¨å¼€å‘ (TDD Integration)

**åŠŸèƒ½ï¼š** å…ˆç”Ÿæˆæµ‹è¯•ç”¨ä¾‹ï¼Œå†ç”Ÿæˆå®ç°ä»£ç 

**ä½¿ç”¨æ–¹å¼ï¼š**
```bash
forge create "è·å–æ¯”ç‰¹å¸ä»·æ ¼" --test-first
```

**å·¥ä½œæµç¨‹ï¼š**
1. æ ¹æ®éœ€æ±‚ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹
2. ç”¨æˆ·ç¡®è®¤æµ‹è¯•é€»è¾‘
3. ç”Ÿæˆæ»¡è¶³æµ‹è¯•çš„å¤„ç†å™¨ä»£ç 

**ä¼˜åŠ¿ï¼š**
- æµ‹è¯•è¦†ç›–æ›´å…¨é¢
- ä»£ç æ›´ç¬¦åˆé¢„æœŸ
- æ”¯æŒ TDD å·¥ä½œæµ

---

### 4. ä¾èµ–ç®¡ç†è‡ªåŠ¨åŒ–

**åŠŸèƒ½ï¼š** è‡ªåŠ¨æ£€æµ‹å¹¶ç”Ÿæˆä¾èµ–åˆ—è¡¨

**è‡ªåŠ¨æ£€æµ‹ï¼š**
- åˆ†æç”Ÿæˆçš„ä»£ç ä¸­çš„ import è¯­å¥
- è¯†åˆ«ç¬¬ä¸‰æ–¹åº“ä¾èµ–
- ç”Ÿæˆ requirements.txt ç‰‡æ®µ

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
ğŸ“¦ Detected Dependencies:
   â€¢ httpx
   â€¢ pandas

ğŸ’¡ Add to requirements.txt:
# AutoForge detected dependencies
httpx  # Auto-detected
pandas  # Auto-detected
```

**æ”¯æŒçš„åº“æ˜ å°„ï¼š**
- `httpx` â†’ `httpx`
- `requests` â†’ `requests`
- `pandas` â†’ `pandas`
- `yaml` â†’ `pyyaml`
- `PIL` â†’ `pillow`
- ç­‰ç­‰...

---

### 5. èƒ½åŠ›ç»„åˆ (Capability Composition) - å¼€å‘ä¸­

**åŠŸèƒ½ï¼š** é€šè¿‡ç»„åˆç°æœ‰èƒ½åŠ›åˆ›å»ºæ–°èƒ½åŠ›

**ä½¿ç”¨æ–¹å¼ï¼š**
```bash
forge compose \
  --base "net.crypto.get_price" \
  --action "if price > 60000 then alert" \
  --id "net.crypto.price_alert"
```

**è®¡åˆ’åŠŸèƒ½ï¼š**
- ç»„åˆå¤šä¸ªåŸºç¡€èƒ½åŠ›
- æ¡ä»¶é€»è¾‘ï¼ˆif/thenï¼‰
- æ•°æ®æµè½¬æ¢
- é”™è¯¯å¤„ç†é“¾

---

## ğŸ“– æ–‡æ¡£ä¼˜åŒ–

### 1. æµç¨‹å›¾å¯è§†åŒ–

åœ¨ç”¨æˆ·æŒ‡å—ä¸­æ·»åŠ äº† Mermaid æµç¨‹å›¾ï¼š

```mermaid
graph LR
    A[è‡ªç„¶è¯­è¨€éœ€æ±‚] --> B(LLM è§£æ)
    B --> C[YAML è§„èŒƒ]
    C --> D[Python ä»£ç ]
    C --> E[Pytest æµ‹è¯•]
    D & E --> F{è‡ªåŠ¨éªŒè¯}
    F -- å¤±è´¥ --> B
    F -- æˆåŠŸ --> G[è½ç›˜å­˜å‚¨]
```

### 2. Diff é¢„è§ˆåŠŸèƒ½

**åŠŸèƒ½ï¼š** æ›´æ–°æ—¶æ˜¾ç¤ºå˜æ›´é¢„è§ˆ

```bash
forge update net.crypto.get_price "æ–°éœ€æ±‚" --preview
```

**æ˜¾ç¤ºå†…å®¹ï¼š**
- Spec å˜æ›´
- Handler ä»£ç å˜æ›´
- Test ä»£ç å˜æ›´

### 3. Prompts Library

**ä½ç½®ï¼š** `docs/AUTOFORGE_PROMPTS_LIBRARY.md`

**å†…å®¹ï¼š**
- ç½‘ç»œè¯·æ±‚ç±»æ¨¡æ¿
- æ–‡ä»¶å¤„ç†ç±»æ¨¡æ¿
- æ•°æ®åº“æ“ä½œç±»æ¨¡æ¿
- API é›†æˆæ¨¡æ¿

**ç¤ºä¾‹ï¼š**
```markdown
## ç½‘ç»œè¯·æ±‚ç±»

**æ¨¡æ¿ï¼š**
"ä» {APIåç§°} è·å– {æ•°æ®ç±»å‹}ï¼Œéœ€è¦ {è®¤è¯æ–¹å¼}"

**ç¤ºä¾‹ï¼š**
- "ä» CoinGecko API è·å–æ¯”ç‰¹å¸ä»·æ ¼ï¼Œéœ€è¦ API key"
- "ä» GitHub API è·å–ä»“åº“ä¿¡æ¯ï¼Œéœ€è¦ OAuth token"
```

---

## ğŸ¯ ä½¿ç”¨ç¤ºä¾‹

### å®Œæ•´å·¥ä½œæµç¤ºä¾‹

```bash
# 1. åˆ›å»ºèƒ½åŠ›ï¼ˆå¸¦å‚è€ƒæ–‡æ¡£ï¼‰
forge create "è°ƒç”¨å…¬å¸ OA API" \
  --reference ./docs/oa_api.md \
  --reference ./examples/auth_example.py \
  --id "net.oa.get_user_info"

# 2. æŸ¥çœ‹ç”Ÿæˆçš„ä¾èµ–
# (è‡ªåŠ¨æ˜¾ç¤ºåœ¨è¾“å‡ºä¸­)

# 3. å®‰è£…ä¾èµ–
pip install httpx requests

# 4. è¿è¡Œæµ‹è¯•
pytest tests/generated/test_net_oa_get_user_info.py

# 5. å‘ç°éœ€è¦æ›´æ–°
forge update net.oa.get_user_info \
  "æ·»åŠ ç¼“å­˜æœºåˆ¶" \
  --reference ./docs/cache_strategy.md \
  --preview

# 6. ç¡®è®¤æ›´æ–°
forge update net.oa.get_user_info "æ·»åŠ ç¼“å­˜æœºåˆ¶"
```

### TDD å·¥ä½œæµç¤ºä¾‹

```bash
# 1. ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹
forge create "å¤„ç† CSV æ–‡ä»¶" --test-first --dry-run

# 2. æŸ¥çœ‹ç”Ÿæˆçš„æµ‹è¯•ç”¨ä¾‹
# (ç¡®è®¤æµ‹è¯•é€»è¾‘æ­£ç¡®)

# 3. ç”Ÿæˆå®Œæ•´å®ç°
forge create "å¤„ç† CSV æ–‡ä»¶" --test-first

# 4. è¿è¡Œæµ‹è¯•ï¼ˆåº”è¯¥å…¨éƒ¨é€šè¿‡ï¼‰
pytest tests/generated/test_io_fs_process_csv.py
```

---

## ğŸ”§ æŠ€æœ¯å®ç°

### å‚è€ƒæ–‡æ¡£åŠ è½½å™¨

**æ–‡ä»¶ï¼š** `src/forge/auto/reference_loader.py`

**åŠŸèƒ½ï¼š**
- æ”¯æŒå¤šç§æ–‡ä»¶æ ¼å¼
- è‡ªåŠ¨æå–ä»£ç ç‰‡æ®µ
- æ ¼å¼åŒ–ç”¨äº LLM prompt

### ä¾èµ–æ£€æµ‹å™¨

**æ–‡ä»¶ï¼š** `src/forge/auto/dependency_detector.py`

**åŠŸèƒ½ï¼š**
- è§£æ import è¯­å¥
- è¯†åˆ«æ ‡å‡†åº“ vs ç¬¬ä¸‰æ–¹åº“
- ç”Ÿæˆ requirements.txt

### æ›´æ–°å‘½ä»¤

**æ–‡ä»¶ï¼š** `tools/forge/cli_update.py`

**åŠŸèƒ½ï¼š**
- åŠ è½½ç°æœ‰æ–‡ä»¶
- ç”Ÿæˆæ›´æ–°ç‰ˆæœ¬
- æ˜¾ç¤ºå˜æ›´é¢„è§ˆ
- ç¡®è®¤è¦†ç›–

---

## ğŸ“Š æ€§èƒ½å½±å“

### å‚è€ƒæ–‡æ¡£
- **åŠ è½½æ—¶é—´ï¼š** < 100ms per file
- **Prompt å¤§å°ï¼š** æ¯ä¸ªæ–‡ä»¶æœ€å¤š 5000 å­—ç¬¦ï¼ˆè‡ªåŠ¨æˆªæ–­ï¼‰
- **LLM æˆæœ¬ï¼š** ç•¥æœ‰å¢åŠ ï¼ˆå–å†³äºå‚è€ƒæ–‡æ¡£å¤§å°ï¼‰

### ä¾èµ–æ£€æµ‹
- **æ£€æµ‹æ—¶é—´ï¼š** < 10ms
- **å‡†ç¡®æ€§ï¼š** ~95%ï¼ˆåŸºäºå¸¸è§åº“æ˜ å°„ï¼‰

### TDD æ¨¡å¼
- **é¢å¤– LLM è°ƒç”¨ï¼š** 1 æ¬¡ï¼ˆç”Ÿæˆæµ‹è¯•ï¼‰
- **æ€»æ—¶é—´ï¼š** å¢åŠ  ~30-50%

---

## ğŸš§ æœªæ¥è®¡åˆ’

1. **èƒ½åŠ›ç»„åˆå®Œæ•´å®ç°**
   - æ”¯æŒå¤æ‚æ¡ä»¶é€»è¾‘
   - æ•°æ®æµç®¡é“
   - é”™è¯¯å¤„ç†é“¾

2. **Diff é¢„è§ˆå¢å¼º**
   - Git é£æ ¼çš„ diff æ˜¾ç¤º
   - è¯­æ³•é«˜äº®
   - è¡Œå·å¯¹æ¯”

3. **Prompts Library æ‰©å±•**
   - æ›´å¤šç±»åˆ«æ¨¡æ¿
   - ç¤¾åŒºè´¡çŒ®
   - æœ€ä½³å®è·µæ¡ˆä¾‹

4. **ä¾èµ–ç®¡ç†å¢å¼º**
   - ç‰ˆæœ¬å·æ£€æµ‹
   - å†²çªæ£€æµ‹
   - è‡ªåŠ¨æ›´æ–° requirements.txt

---

## ğŸ’¡ æœ€ä½³å®è·µ

1. **ä½¿ç”¨å‚è€ƒæ–‡æ¡£**
   - æä¾› API æ–‡æ¡£æé«˜å‡†ç¡®æ€§
   - å‚è€ƒç°æœ‰ä»£ç ä¿æŒé£æ ¼ä¸€è‡´
   - å¤šä¸ªå°æ–‡ä»¶ä¼˜äºä¸€ä¸ªå¤§æ–‡ä»¶

2. **TDD æ¨¡å¼**
   - å¤æ‚é€»è¾‘ä½¿ç”¨ TDD
   - ç®€å•æ“ä½œä½¿ç”¨å¸¸è§„æ¨¡å¼
   - é¢„è§ˆæµ‹è¯•ç”¨ä¾‹ç¡®è®¤é€»è¾‘

3. **ä¾èµ–ç®¡ç†**
   - å®šæœŸæ£€æŸ¥ç”Ÿæˆçš„ä¾èµ–
   - æ‰‹åŠ¨éªŒè¯ç‰ˆæœ¬å…¼å®¹æ€§
   - ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒéš”ç¦»

4. **æ›´æ–°å·¥ä½œæµ**
   - æ€»æ˜¯å…ˆé¢„è§ˆï¼ˆ`--preview`ï¼‰
   - ä½¿ç”¨ç‰ˆæœ¬æ§åˆ¶ï¼ˆGitï¼‰
   - ä¿ç•™å¤‡ä»½

---

**äº«å—ä½¿ç”¨å¢å¼ºçš„ AutoForgeï¼ğŸ‰**
